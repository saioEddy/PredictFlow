
# PredictFlow 智能预测平台

## 📋 目录

1. [项目概述](#项目概述)
2. [业务流程图](#业务流程图)
3. [核心功能演示](#核心功能演示)
4. [技术架构](#技术架构)
5. [技术栈详解](#技术栈详解)
6. [系统特点](#系统特点)

---

## 项目概述

**PredictFlow** 是一个基于机器学习的智能预测平台，专门用于阀门等工业设备的性能预测。系统通过神经网络模型，根据输入的载荷和频率参数，自动预测多个关键性能指标（如应力、应变、温度、寿命等）。

### 核心价值

- ✅ **自动化训练**：智能识别数据列，自动训练多输出回归模型
- ✅ **Web化操作**：提供友好的Web界面，无需编程即可使用
- ✅ **实时预测**：输入参数即时获得预测结果
- ✅ **安全认证**：JWT Token认证机制，保障系统安全

---

## 业务流程图

### 整体业务流程

```
┌─────────────┐
│  用户登录   │
│  (JWT认证)  │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  参数输入   │
│ (载荷/频率) │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  模型预测   │
│  (多输出)   │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  结果展示   │
│ (应力/应变) │
└─────────────┘
```

### 详细业务逻辑

#### 1️⃣ 用户登录流程

```
前端 (React)
    │
    │ POST /api/login
    │ {username, password} 
    │
    ▼
后端 (FastAPI)
    │
    │ 验证用户名密码
    │ 
    │
    │ 生成JWT Token
    │ 
    │
    ▼
返回 Token
    │
    │ {success: true, token: "xxx"}
    │
    ▼
前端存储 Token
    │
    │ localStorage.setItem('token', token)
    │
    ▼
跳转到预测页面
```

**技术要点：**
- 使用 JWT (JSON Web Token) 进行无状态认证
- Token 存储在浏览器 localStorage
- 所有后续请求携带 `Authorization: Bearer {token}` 头

#### 2️⃣ 模型训练流程

```
准备训练数据
    │
    │ CSV/Excel 文件
    │ (包含输入列和输出列)
    │
    ▼
运行训练脚本
    │
    │ python scripts/inspect_and_train.py data.csv
    │
    ▼
数据探索阶段
    │
    │ ├─ 自动识别输入列
    │ │  (模糊匹配: frequency, load, 频率, 载荷)
    │ │
    │ ├─ 自动识别输出列
    │ │  (数值型列，排除输入列)
    │ │
    │ └─ 相关性分析
    │    (输入-输出相关性矩阵)
    │
    ▼
用户确认/修改
    │
    │ 交互式选择或自动接受
    │
    ▼
数据预处理
    │
    │ ├─ 数值化转换
    │ │  (清理单位: "100MPA" → 100.0)
    │ │
    │ └─ 缺失值填充
    │    
    │
    ▼
模型训练
    │
    │ ├─ 数据划分
    │ │  (训练集80%, 测试集20%)
    │ │
    │ ├─ 随机森林模型
    │ │  (n_estimators=200)
    │ │
    │ └─ 多输出回归
    │    (MultiOutputRegressor)
    │
    ▼
模型评估
    │
    │ ├─ R² 分数
    │ │  (拟合优度)
    │ │
    │ └─ MAE 误差
    │    (平均绝对误差)
    │
    ▼
保存模型
    │
    │ models/model.joblib
    │ {
    │   "model": RandomForest模型,
    │   "inputs": ["频率", "载荷"],
    │   "outputs": ["应力", "应变", "温度", "寿命"]
    │ }
```

**技术要点：**
- 使用 scikit-learn 的 RandomForestRegressor
- MultiOutputRegressor 支持同时预测多个目标变量
- 自动列识别使用模糊匹配算法
- 模型序列化使用 joblib

#### 3️⃣ 预测流程

```
用户输入参数
    │
    │ 载荷: 2.0
    │ 频率: 1.5
    │
    ▼
前端发送请求
    │
    │ POST /api/predict
    │ Authorization: Bearer {token}
    │ {load: 2.0, frequency: 1.5}
    │
    ▼
后端验证Token
    │
    │ JWT Token 验证
    │ (过期/无效 → 401)
    │
    ▼
加载模型
    │
    │ 从 models/model.joblib 加载
    │ (启动时已加载到内存)
    │
    ▼
数据预处理
    │
    │ ├─ 匹配输入列名
    │ │  (支持中英文列名)
    │ │
    │ └─ 构建输入DataFrame
    │    (确保列顺序正确)
    │
    ▼
模型预测
    │
    │ model.predict(X)
    │
    ▼
构建响应
    │
    │ {
    │   "predictions": {
    │     "应力": 145.23,
    │     "应变": 0.0234,
    │     "温度": 78.90,
    │     "寿命": 12345.67
    │   },
    │   "input_data": {
    │     "load": 2.0,
    │     "frequency": 1.5
    │   }
    │ }
    │
    ▼
前端展示结果
    │
    │ 格式化显示预测值
    │ (保留4位小数)
```

**技术要点：**
- 模型在服务启动时加载，避免重复IO
- 支持中英文列名自动匹配
- 实时预测，响应时间 < 100ms

---

## 核心功能演示

### 功能1: 用户登录

**界面展示：**
```
┌─────────────────────────┐
│   PredictFlow            │
│   用户登录               │
│                         │
│   用户名: [________]    │
│   密码:   [________]    │
│                         │
│   [  登录  ]            │
│                         │
└─────────────────────────┘
```

**API接口：**
- **端点**: `POST /api/login`
- **请求体**: 
  ```json
  {
    "username": "admin",
    "password": "admin123"
  }
  ```
- **响应**: 
  ```json
  {
    "success": true,
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "message": "登录成功"
  }
  ```

### 功能2: 模型训练

**命令行操作：**
```bash
# 交互式训练（推荐）
python scripts/inspect_and_train.py data/train/example_data.csv

# 自动训练
python scripts/inspect_and_train.py data/train/example_data.csv --auto

# 指定列名训练
python scripts/inspect_and_train.py data/train/example_data.csv \
    --inputs frequency_multiple,load_multiple \
    --outputs stress,strain,temperature,life
```

**训练过程输出：**
```
已加载数据，行数=1000, 列数=6

=== 列信息 ===
  0. frequency_multiple    类型=float64    缺失值=0
  1. load_multiple         类型=float64    缺失值=0
  2. stress                类型=float64    缺失值=5
  3. strain                类型=float64    缺失值=3
  4. temperature           类型=float64    缺失值=0
  5. life                  类型=float64    缺失值=0

=== 输入-输出相关性分析 ===
-- frequency_multiple 与输出列的相关性 --
stress       0.8523
strain       0.7891
temperature  0.7234
life        -0.6234

最终选定的输入列： ['frequency_multiple', 'load_multiple']
最终选定的输出列： ['stress', 'strain', 'temperature', 'life']

开始训练模型...
训练集样本数：800
测试集样本数：200

=== 模型评估结果 ===
stress               -> R2: 0.9245  MAE: 12.3456
strain               -> R2: 0.8932  MAE: 0.0234
temperature          -> R2: 0.8567  MAE: 3.4567
life                 -> R2: 0.7891  MAE: 234.5678

模型已保存到: models/model.joblib
```

### 功能3: 在线预测

**界面展示：**
```
┌─────────────────────────────────────┐
│  PredictFlow          [退出登录]    │
│                                     │
│  输入预测参数                        │
│  ┌─────────────────────────────┐   │
│  │ 载荷:  [2.0        ]        │   │
│  │ 频率:  [1.5        ]        │   │
│  │                            │   │
│  │  [  开始预测  ]            │   │
│  └─────────────────────────────┘   │
│                                     │
│  模型信息                            │
│  输入列：frequency_multiple, ...   │
│  输出列：stress, strain, ...       │
│                                     │
│  预测结果                            │
│  ┌─────────────────────────────┐   │
│  │ 输入参数                     │   │
│  │ 载荷: 2.0                   │   │
│  │ 频率: 1.5                   │   │
│  │                            │   │
│  │ 预测输出                     │   │
│  │ stress: 145.2340            │   │
│  │ strain: 0.0234             │   │
│  │ temperature: 78.9000       │   │
│  │ life: 12345.6700           │   │
│  └─────────────────────────────┘   │
└─────────────────────────────────────┘
```

**API接口：**
- **端点**: `POST /api/predict`
- **请求头**: `Authorization: Bearer {token}`
- **请求体**: 
  ```json
  {
    "load": 2.0,
    "frequency": 1.5
  }
  ```
- **响应**: 
  ```json
  {
    "predictions": {
      "stress": 145.2340,
      "strain": 0.0234,
      "temperature": 78.9000,
      "life": 12345.6700
    },
    "input_data": {
      "load": 2.0,
      "frequency": 1.5
    }
  }
  ```

### 功能4: 健康检查

**API接口：**
- **端点**: `GET /api/health`
- **响应**: 
  ```json
  {
    "status": "ok",
    "model_loaded": true,
    "timestamp": "2024-01-15T10:30:00",
    "model_info": {
      "inputs": ["frequency_multiple", "load_multiple"],
      "outputs": ["stress", "strain", "temperature", "life"]
    }
  }
  ```

---

## 技术架构

### 系统架构图

```
┌─────────────────────────────────────────────────────────┐
│                      用户浏览器                          │
│  ┌──────────────────────────────────────────────────┐  │
│  │         React 前端应用                           │  │
│  │  - React Router (路由)                           │  │
│  │  - Axios (HTTP客户端)                            │  │
│  │  - LocalStorage (Token存储)                      │  │
│  └──────────────────────────────────────────────────┘  │
└───────────────────────┬─────────────────────────────────┘
                        │
                        │ HTTP/HTTPS
                        │
┌───────────────────────▼─────────────────────────────────┐
│              FastAPI 后端服务                           │
│  ┌──────────────────────────────────────────────────┐  │
│  │  API 路由层                                       │  │
│  │  - /api/login (登录)                              │  │
│  │  - /api/predict (预测)                            │  │
│  │  - /api/health (健康检查)                          │  │
│  │  - /api/model-info (模型信息)                      │  │
│  └──────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────┐  │
│  │  中间件层                                         │  │
│  │  - CORS (跨域支持)                                │  │
│  │  - JWT 认证                                       │  │
│  │  - 请求日志                                       │  │
│  └──────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────┐  │
│  │  业务逻辑层                                       │  │
│  │  - 用户认证服务                                   │  │
│  │  - 预测服务                                       │  │
│  └──────────────────────────────────────────────────┘  │
└───────────────────────┬─────────────────────────────────┘
                        │
                        │
┌───────────────────────▼─────────────────────────────────┐
│              机器学习模型层                              │
│  ┌──────────────────────────────────────────────────┐  │
│  │  scikit-learn                                    │  │
│  │  - RandomForestRegressor                         │  │
│  │  - MultiOutputRegressor                          │  │
│  │  - joblib (模型序列化)                           │  │
│  └──────────────────────────────────────────────────┘  │
└───────────────────────┬─────────────────────────────────┘
                        │
                        │
┌───────────────────────▼─────────────────────────────────┐
│              数据处理层                                  │
│  ┌──────────────────────────────────────────────────┐  │
│  │  pandas (数据处理)                                │  │
│  │  numpy (数值计算)                                 │  │
│  │  - 数据加载 (CSV/Excel)                           │  │
│  │  - 数据预处理 (缺失值填充)                         │  │
│  │  - 特征工程                                       │  │
│  └──────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

### 部署架构

```
┌─────────────────────────────────────────────────────────┐
│                   生产环境部署                           │
│                                                         │
│  ┌──────────────┐         ┌──────────────┐            │
│  │  Nginx       │         │  Tomcat      │            │
│  │  (反向代理)   │─────────▶│  (前端静态)   │            │
│  └──────────────┘         └──────────────┘            │
│         │                                               │
│         │                                               │
│         ▼                                               │
│  ┌──────────────┐                                      │
│  │  Uvicorn     │                                      │
│  │  (ASGI服务器) │                                      │
│  └──────┬───────┘                                      │
│         │                                               │
│         ▼                                               │
│  ┌──────────────┐                                      │
│  │  FastAPI     │                                      │
│  │  (应用服务)   │                                      │
│  └──────────────┘                                      │
│                                                         │
│  或者使用 Docker 容器化部署：                            │
│  ┌──────────────────────────────────────────────────┐ │
│  │  Docker Container                                │ │
│  │  - FastAPI + Uvicorn                             │ │
│  │  - 模型文件 (models/)                            │ │
│  │  - 静态文件 (frontend/build/)                    │ │
│  └──────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

---

## 技术栈详解

### 前端技术栈

| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| **React** | 18.x | UI框架 | 组件化开发，响应式界面 |
| **React Router** | 6.x | 路由管理 | 单页应用路由，页面跳转 |
| **Axios** | 1.x | HTTP客户端 | API请求，拦截器处理 |
| **CSS3** | - | 样式设计 | 响应式布局，现代化UI |

**前端特点：**
- ✅ 单页应用 (SPA)，无需刷新页面
- ✅ 组件化设计，易于维护
- ✅ 支持运行时配置，适应不同部署环境
- ✅ Token自动管理，过期自动跳转登录

### 后端技术栈

| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| **FastAPI** | 0.95+ | Web框架 | 高性能异步框架，自动API文档 |
| **Uvicorn** | 0.21+ | ASGI服务器 | 生产级WSGI/ASGI服务器 |
| **python-jose** | 3.3+ | JWT认证 | Token生成和验证 |
| **Pydantic** | - | 数据验证 | 请求/响应模型验证 |

**后端特点：**
- ✅ 异步处理，高并发性能
- ✅ 自动生成 OpenAPI/Swagger 文档
- ✅ 类型提示，代码可读性强
- ✅ 中间件支持，灵活扩展

### 机器学习技术栈

| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| **scikit-learn** | 1.0+ | 机器学习库 | 模型训练和预测 |
| **RandomForestRegressor** | - | 回归模型 | 随机森林算法 |
| **MultiOutputRegressor** | - | 多输出回归 | 同时预测多个目标变量 |
| **joblib** | 1.1+ | 模型序列化 | 模型保存和加载 |

**模型特点：**
- ✅ 随机森林：集成学习，鲁棒性强
- ✅ 多输出回归：一次预测多个指标
- ✅ 自动特征选择：智能识别输入输出列
- ✅ 模型评估：R²和MAE指标

### 数据处理技术栈

| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| **pandas** | 1.3+ | 数据处理 | DataFrame操作，数据清洗 |
| **numpy** | 1.21+ | 数值计算 | 数组运算，数学计算 |
| **openpyxl** | 3.0+ | Excel支持 | 读取/写入Excel文件 |

**数据处理特点：**
- ✅ 支持CSV和Excel格式
- ✅ 自动缺失值处理（中位数填充）
- ✅ 数值单位自动清理
- ✅ 数据类型自动转换

### 部署技术栈

| 技术 | 版本 | 用途 | 说明 |
|------|------|------|------|
| **Shiv** | - | 应用打包 | 单文件可执行包 |
| **Docker** | - | 容器化 | 容器部署，环境隔离 |
| **Uvicorn** | - | 生产服务器 | ASGI服务器，支持多进程 |

**部署特点：**
- ✅ 支持单文件打包（.shiv）
- ✅ Docker容器化部署
- ✅ 支持Tomcat静态文件部署
- ✅ 环境变量配置，灵活适配

---

## 系统特点

### 1. 智能化

- **自动列识别**：基于模糊匹配规则，自动识别输入输出列
- **相关性分析**：自动计算输入-输出相关性，辅助特征选择
- **数据预处理**：自动处理缺失值、数据类型转换、单位清理

### 2. 易用性

- **Web界面**：无需编程，通过浏览器即可使用
- **交互式训练**：支持交互式确认，也支持全自动模式
- **实时预测**：输入参数即时获得结果

### 3. 安全性

- **JWT认证**：无状态认证，Token过期自动失效
- **Token验证**：所有预测接口需要Token验证
- **CORS配置**：支持跨域访问（生产环境可限制）

### 4. 可扩展性

- **模块化设计**：前后端分离，易于扩展
- **配置化**：通过config.py集中管理参数
- **多模型支持**：可轻松替换为XGBoost、LightGBM等

### 5. 高性能

- **模型预加载**：服务启动时加载模型，避免重复IO
- **异步处理**：FastAPI异步框架，支持高并发
- **批量预测**：支持从文件批量预测

---

## 使用场景

### 场景1: 阀门性能预测

**业务需求：**
根据阀门的载荷和频率参数，预测其应力、应变、温度和寿命。

**操作流程：**
1. 准备历史数据（包含载荷、频率、应力、应变等）
2. 运行训练脚本生成模型
3. 通过Web界面输入新的载荷和频率
4. 获得预测结果，用于产品设计优化

### 场景2: 批量预测

**业务需求：**
对大量数据进行批量预测，生成预测报告。

**操作流程：**
1. 准备包含输入列的CSV文件
2. 使用命令行工具批量预测
3. 导出预测结果到Excel/CSV
4. 进行数据分析和报告生成

### 场景3: 模型迭代优化

**业务需求：**
随着数据积累，需要定期重新训练模型，提升预测精度。

**操作流程：**
1. 收集新的训练数据
2. 合并历史数据
3. 重新训练模型
4. 对比新旧模型评估指标
5. 部署新模型到生产环境

---

## 性能指标

### 模型性能

- **R² 分数**：通常 > 0.85（优秀）
- **MAE 误差**：根据业务需求，通常在可接受范围内
- **训练时间**：1000条数据约 5-10 秒
- **预测时间**：单次预测 < 100ms

### 系统性能

- **并发支持**：FastAPI异步框架，支持高并发
- **响应时间**：API响应 < 200ms（不含网络延迟）
- **内存占用**：模型加载后约 50-200MB（取决于模型大小）

---

## 总结

**PredictFlow** 是一个完整的端到端机器学习预测平台，从数据训练到Web预测，提供了完整的解决方案。系统采用现代化的技术栈，具有良好地可扩展性和维护性，适用于工业设备性能预测等多种场景。

### 核心优势

1. ✅ **全流程自动化**：从数据识别到模型训练，最小化人工干预
2. ✅ **Web化操作**：友好的用户界面，降低使用门槛
3. ✅ **高性能预测**：实时预测，满足生产需求
4. ✅ **安全可靠**：JWT认证，保障系统安全
5. ✅ **易于部署**：支持多种部署方式，适应不同环境

---



