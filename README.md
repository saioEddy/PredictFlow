# PredictFlow - æ™ºèƒ½æ•°æ®æ¢ç´¢ä¸æ¨¡å‹è®­ç»ƒå·¥å…·

ä¸€ä¸ªå¼ºå¤§çš„è‡ªåŠ¨åŒ–æœºå™¨å­¦ä¹ å·¥å…·ï¼Œä¸“ä¸ºå¤„ç†æœªçŸ¥ç»“æ„çš„å®¢æˆ·æ•°æ®è®¾è®¡ã€‚èƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«è¾“å…¥è¾“å‡ºåˆ—ã€è®­ç»ƒå¤šè¾“å‡ºå›å½’æ¨¡å‹ï¼Œå¹¶æä¾›ä¾¿æ·çš„é¢„æµ‹åŠŸèƒ½ã€‚

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

- **æ™ºèƒ½åˆ—è¯†åˆ«**ï¼šè‡ªåŠ¨è¯†åˆ«è¾“å…¥åˆ—ï¼ˆåŸºäºæ¨¡ç³ŠåŒ¹é…è§„åˆ™ï¼‰å’Œè¾“å‡ºåˆ—ï¼ˆæ•°å€¼å‹ï¼‰
- **äº¤äº’å¼ä¸è‡ªåŠ¨åŒ–æ¨¡å¼**ï¼šæ”¯æŒäººå·¥ç¡®è®¤å’Œå…¨è‡ªåŠ¨è¿è¡Œä¸¤ç§æ¨¡å¼
- **æ•°æ®æ¢ç´¢**ï¼šè‡ªåŠ¨å±•ç¤ºæ•°æ®ç»Ÿè®¡ä¿¡æ¯ã€ç¼ºå¤±å€¼åˆ†æã€ç›¸å…³æ€§çŸ©é˜µ
- **å¤šè¾“å‡ºå›å½’**ï¼šæ”¯æŒåŒæ—¶é¢„æµ‹å¤šä¸ªç›®æ ‡å˜é‡
- **çµæ´»çš„æ•°æ®æ ¼å¼**ï¼šæ”¯æŒ CSV å’Œ Excel æ–‡ä»¶
- **ç®€å•æ˜“ç”¨**ï¼šå‘½ä»¤è¡Œç•Œé¢ï¼Œæœ€å°‘å¹²é¢„å³å¯å®Œæˆè®­ç»ƒ

## ğŸ“¦ å®‰è£…

### 1. å…‹éš†æˆ–ä¸‹è½½é¡¹ç›®

```bash
cd /path/to/PredictFlow
```

### 2. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

ä¾èµ–åŒ…æ‹¬ï¼š
- pandasï¼ˆæ•°æ®å¤„ç†ï¼‰
- numpyï¼ˆæ•°å€¼è®¡ç®—ï¼‰
- scikit-learnï¼ˆæœºå™¨å­¦ä¹ ï¼‰
- openpyxlï¼ˆExcelæ”¯æŒï¼‰
- joblibï¼ˆæ¨¡å‹ä¿å­˜ï¼‰

## ğŸš€ å¿«é€Ÿå¼€å§‹

### è®­ç»ƒæ¨¡å‹

#### æ–¹å¼1ï¼šäº¤äº’å¼æ¨¡å¼ï¼ˆæ¨èï¼‰

```bash
python scripts/inspect_and_train.py data/train/your_data.csv
```

è„šæœ¬ä¼šï¼š
1. åŠ è½½æ•°æ®å¹¶å±•ç¤ºåˆ—ä¿¡æ¯
2. è‡ªåŠ¨è¯†åˆ«å€™é€‰è¾“å…¥åˆ—å’Œè¾“å‡ºåˆ—
3. æ˜¾ç¤ºè¾“å…¥-è¾“å‡ºç›¸å…³æ€§åˆ†æ
4. ç­‰å¾…ä½ ç¡®è®¤æˆ–ä¿®æ”¹åˆ—é€‰æ‹©
5. è®­ç»ƒæ¨¡å‹å¹¶ä¿å­˜

#### æ–¹å¼2ï¼šè‡ªåŠ¨æ¨¡å¼

```bash
python scripts/inspect_and_train.py data/train/your_data.csv --auto
```

ç›´æ¥ä½¿ç”¨è‡ªåŠ¨è¯†åˆ«çš„åˆ—è¿›è¡Œè®­ç»ƒï¼Œæ— éœ€äººå·¥å¹²é¢„ã€‚

#### æ–¹å¼3ï¼šæŒ‡å®šåˆ—å

```bash
python scripts/inspect_and_train.py data/train/your_data.csv \
    --inputs frequency_multiple,load_multiple \
    --outputs stress,strain,temperature,life \
    --out-model models/my_model.joblib
```

### ä½¿ç”¨æ¨¡å‹é¢„æµ‹

#### ä»æ–‡ä»¶é¢„æµ‹

```bash
python scripts/predict.py --model models/model.joblib --input data/input/new_data.csv --output output/predictions.csv
```

#### äº¤äº’å¼é¢„æµ‹

```bash
python scripts/predict.py --model models/model.joblib --interactive
```

é€ä¸ªè¾“å…¥ç‰¹å¾å€¼ï¼Œå®æ—¶è·å–é¢„æµ‹ç»“æœã€‚

## ğŸ“– è¯¦ç»†ä½¿ç”¨è¯´æ˜

### inspect_and_train.py å‚æ•°

| å‚æ•° | è¯´æ˜ | å¿…éœ€ | ç¤ºä¾‹ |
|------|------|------|------|
| `path` | æ•°æ®æ–‡ä»¶è·¯å¾„ | âœ“ | `data.csv` |
| `--inputs` | é€—å·åˆ†éš”çš„è¾“å…¥åˆ—å | âœ— | `freq,load` |
| `--outputs` | é€—å·åˆ†éš”çš„è¾“å‡ºåˆ—å | âœ— | `stress,strain` |
| `--out-model` | æ¨¡å‹ä¿å­˜è·¯å¾„ | âœ— | `models/model.joblib` (é»˜è®¤) |
| `--auto` | è‡ªåŠ¨æ¨¡å¼ï¼Œä¸äº¤äº’ | âœ— | - |

### predict.py å‚æ•°

| å‚æ•° | è¯´æ˜ | å¿…éœ€ | ç¤ºä¾‹ |
|------|------|------|------|
| `--model` | æ¨¡å‹æ–‡ä»¶è·¯å¾„ | âœ“ | `models/model.joblib` |
| `--input` | è¾“å…¥æ•°æ®æ–‡ä»¶è·¯å¾„ | * | `data/input/new_data.csv` |
| `--output` | è¾“å‡ºç»“æœæ–‡ä»¶è·¯å¾„ | âœ— | `output/predictions.csv` |
| `--interactive` | äº¤äº’å¼é¢„æµ‹æ¨¡å¼ | * | - |

*æ³¨ï¼š`--input` å’Œ `--interactive` å¿…é¡»é€‰æ‹©å…¶ä¸€

## ğŸ” è‡ªåŠ¨åˆ—è¯†åˆ«è§„åˆ™

è„šæœ¬ä½¿ç”¨ä»¥ä¸‹å…³é”®è¯è¿›è¡Œæ¨¡ç³ŠåŒ¹é…ï¼Œè‡ªåŠ¨è¯†åˆ«è¾“å…¥åˆ—ï¼š

- é¢‘ç‡ç›¸å…³ï¼š`freq`, `frequency`, `é¢‘ç‡`, `å€æ•°`, `mult`, `multiple`
- è½½è·ç›¸å…³ï¼š`load`, `è½½è·`, `è½½é‡`, `payload`

å…¶ä»–æ•°å€¼åˆ—è‡ªåŠ¨ä½œä¸ºå€™é€‰è¾“å‡ºåˆ—ã€‚

å¦‚æœåˆ—åä¸ç¬¦åˆè¿™äº›è§„åˆ™ï¼Œå¯ä»¥ï¼š
1. ä½¿ç”¨äº¤äº’æ¨¡å¼æ‰‹åŠ¨é€‰æ‹©
2. ä½¿ç”¨ `--inputs` å’Œ `--outputs` å‚æ•°ç›´æ¥æŒ‡å®š

## ğŸ“Š è¾“å‡ºç¤ºä¾‹

### è®­ç»ƒè¿‡ç¨‹è¾“å‡º

```
å·²åŠ è½½æ•°æ®ï¼Œè¡Œæ•°=1000, åˆ—æ•°=8

=== åˆ—ä¿¡æ¯ ===
  0. frequency_multiple    ç±»å‹=float64    ç¼ºå¤±å€¼=0
  1. load_multiple         ç±»å‹=float64    ç¼ºå¤±å€¼=0
  2. stress                ç±»å‹=float64    ç¼ºå¤±å€¼=5
  3. strain                ç±»å‹=float64    ç¼ºå¤±å€¼=3
  ...

=== è¾“å…¥-è¾“å‡ºç›¸å…³æ€§åˆ†æ ===
-- frequency_multiple ä¸è¾“å‡ºåˆ—çš„ç›¸å…³æ€§ --
stress    0.8523
strain    0.7891
...

æœ€ç»ˆé€‰å®šçš„è¾“å…¥åˆ—ï¼š ['frequency_multiple', 'load_multiple']
æœ€ç»ˆé€‰å®šçš„è¾“å‡ºåˆ—ï¼š ['stress', 'strain', 'temperature', 'life']

å¼€å§‹è®­ç»ƒæ¨¡å‹...
è®­ç»ƒé›†æ ·æœ¬æ•°ï¼š800
æµ‹è¯•é›†æ ·æœ¬æ•°ï¼š200

=== æ¨¡å‹è¯„ä¼°ç»“æœ ===
stress               -> R2: 0.9245  MAE: 12.3456
strain               -> R2: 0.8932  MAE: 0.0234
temperature          -> R2: 0.8567  MAE: 3.4567
life                 -> R2: 0.7891  MAE: 234.5678

æ¨¡å‹å·²ä¿å­˜åˆ°: models/model.joblib
```

### é¢„æµ‹ç»“æœç¤ºä¾‹

```
é¢„æµ‹ç»“æœé¢„è§ˆ:
   frequency_multiple  load_multiple      stress     strain  temperature      life
0                 1.5            2.0   145.2340   0.023456        78.90  12345.67
1                 2.0            2.5   189.5670   0.031234        89.12  10234.56
2                 2.5            3.0   234.8900   0.039012       101.23   8765.43
```

## ğŸ› ï¸ æ•°æ®é¢„å¤„ç†

è„šæœ¬è‡ªåŠ¨å¤„ç†ä»¥ä¸‹æƒ…å†µï¼š

1. **ç¼ºå¤±å€¼**ï¼šä½¿ç”¨åˆ—ä¸­ä½æ•°å¡«å……
2. **ç±»å‹è½¬æ¢**ï¼šè‡ªåŠ¨å°†æ–‡æœ¬åˆ—è½¬æ¢ä¸ºæ•°å€¼ï¼ˆå¦‚æœå¯èƒ½ï¼‰
3. **åˆ—é¡ºåº**ï¼šè‡ªåŠ¨è°ƒæ•´ä¸ºæ¨¡å‹è®­ç»ƒæ—¶çš„é¡ºåº

## ğŸ“ é¡¹ç›®ç»“æ„

```
PredictFlow/
â”œâ”€â”€ inspect_and_train.py    # ä¸»è®­ç»ƒè„šæœ¬
â”œâ”€â”€ predict.py              # é¢„æµ‹è„šæœ¬
â”œâ”€â”€ requirements.txt        # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ README.md              # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ example_data.csv       # ç¤ºä¾‹æ•°æ®
â””â”€â”€ models/                # ä¿å­˜è®­ç»ƒå¥½çš„æ¨¡å‹ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
```

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### å¦‚æœä¸ç¡®å®šåˆ—å

1. å…ˆè¿è¡Œäº¤äº’æ¨¡å¼æŸ¥çœ‹æ•°æ®ç»“æ„ï¼š
   ```bash
   python inspect_and_train.py your_data.csv
   ```

2. æŸ¥çœ‹è¾“å‡ºçš„åˆ—ä¿¡æ¯å’Œç›¸å…³æ€§åˆ†æ

3. æ ¹æ®æç¤ºé€‰æ‹©åˆé€‚çš„è¾“å…¥è¾“å‡ºåˆ—

### å¦‚æœæ•°æ®é‡å¾ˆå¤§

- ä½¿ç”¨ `--auto` æ¨¡å¼é…åˆæŒ‡å®šåˆ—åï¼Œé¿å…äº¤äº’ç­‰å¾…
- è€ƒè™‘è°ƒæ•´ `inspect_and_train.py` ä¸­çš„ `n_estimators` å‚æ•°ï¼ˆé»˜è®¤200ï¼‰

### å¦‚æœéœ€è¦æ›´å¥½çš„æ¨¡å‹æ€§èƒ½

å¯ä»¥åœ¨ `inspect_and_train.py` ä¸­ä¿®æ”¹æ¨¡å‹å‚æ•°ï¼š

```python
base = RandomForestRegressor(
    n_estimators=500,      # å¢åŠ æ ‘çš„æ•°é‡
    max_depth=20,          # é™åˆ¶æ ‘çš„æ·±åº¦
    min_samples_split=5,   # è°ƒæ•´åˆ†è£‚æ¡ä»¶
    n_jobs=-1, 
    random_state=42
)
```

æˆ–å°è¯•å…¶ä»–æ¨¡å‹ï¼ˆå¦‚ XGBoostã€LightGBMï¼‰ã€‚

## âš ï¸ å¸¸è§é—®é¢˜

### Q: æç¤º"æ²¡æœ‰è¯†åˆ«åˆ°è¾“å…¥åˆ—"æ€ä¹ˆåŠï¼Ÿ

A: åˆ—åå¯èƒ½ä¸ç¬¦åˆé»˜è®¤çš„åŒ¹é…è§„åˆ™ï¼Œä½¿ç”¨ `--inputs` å‚æ•°æ‰‹åŠ¨æŒ‡å®šï¼š
```bash
python inspect_and_train.py data.csv --inputs col1,col2
```

### Q: æ¨¡å‹è¯„ä¼°åˆ†æ•°å¾ˆä½ï¼ˆR2 < 0.5ï¼‰ï¼Ÿ

A: å¯èƒ½çš„åŸå› ï¼š
- è¾“å…¥ç‰¹å¾é€‰æ‹©ä¸åˆç†
- æ•°æ®è´¨é‡é—®é¢˜ï¼ˆç¼ºå¤±å€¼è¿‡å¤šã€å¼‚å¸¸å€¼ï¼‰
- è¾“å…¥è¾“å‡ºä¹‹é—´æ²¡æœ‰æ˜æ˜¾çš„çº¿æ€§æˆ–éçº¿æ€§å…³ç³»
- éœ€è¦ç‰¹å¾å·¥ç¨‹æˆ–ä½¿ç”¨æ›´å¤æ‚çš„æ¨¡å‹

### Q: æ”¯æŒå…¶ä»–æ•°æ®æ ¼å¼å—ï¼Ÿ

A: ç›®å‰æ”¯æŒ CSV å’Œ Excel (.xls, .xlsx)ã€‚å¦‚éœ€å…¶ä»–æ ¼å¼ï¼Œå¯ä¿®æ”¹ `load_data()` å‡½æ•°ã€‚

### Q: å¯ä»¥ç”¨äºåˆ†ç±»ä»»åŠ¡å—ï¼Ÿ

A: å½“å‰ç‰ˆæœ¬ä»…æ”¯æŒå›å½’ä»»åŠ¡ã€‚å¦‚éœ€åˆ†ç±»ï¼Œéœ€ä¿®æ”¹ä¸ºä½¿ç”¨ `RandomForestClassifier`ã€‚

## ğŸ”§ è‡ªå®šä¹‰æ‰©å±•

### æ·»åŠ è‡ªå®šä¹‰è¾“å…¥åˆ—è¯†åˆ«è§„åˆ™

ç¼–è¾‘ `inspect_and_train.py` ä¸­çš„ `FUZZY_INPUT_KEYS`ï¼š

```python
FUZZY_INPUT_KEYS = [
    "freq", "frequency", "é¢‘ç‡", "å€æ•°",
    "load", "è½½è·",
    # æ·»åŠ ä½ çš„å…³é”®è¯
    "pressure", "å‹åŠ›",
    "velocity", "é€Ÿåº¦"
]
```

### æ›´æ¢æœºå™¨å­¦ä¹ æ¨¡å‹

å°† `train_and_save()` å‡½æ•°ä¸­çš„æ¨¡å‹æ›¿æ¢ä¸ºå…¶ä»–ç®—æ³•ï¼š

```python
from xgboost import XGBRegressor

base = XGBRegressor(n_estimators=200, learning_rate=0.1)
model = MultiOutputRegressor(base)
```

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“® è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ Issue åé¦ˆã€‚

---

**ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰

